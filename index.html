<!DOCTYPE html>
<html>
<head>
    <title>React.js and Flux architecture</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="./assets/css/base.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
      .remark-inline-code{
        font-size: 18px;
        color: #333;
        background: #f8f8f8;
      }
    </style>
</head>
<body>
    <header>
        <img class="epam-logo" src="./assets/img/logo.png"/>
        <h1>React.js and Flux architecture</h1>
    </header>

<!-- ================== Slides ================== -->
    <textarea id="source">


class: center, middle

.title[
Front-end training
# React.js and Flux architecture
]

---


# 1 percent but growing!

<img width='500px' src='assets/img/it-angular.png' />
<img width='500px' src='assets/img/it-react.png' />

<small>Screenshots from <a href="http://www.itjobswatch.co.uk/">http://www.itjobswatch.co.uk/</a></small>

---

# React.js

<img width='120px' src="assets/img/react-logo.png" />

React.js key ideas:
- virtual DOM
- component framework

What makes React special:
- simple to learn
- fast rendering
- composable components
- no direct DOM manipulation
- easy to integrate into existing projects
---


# Bootstrapping
React components are widgets that can render themselves and react to user input.
React is bootstraped by rendering root React component into DOM.

Method signature:
```javascript
    ReactComponent render(
		ReactElement element,
		DOMElement container,
		[function callback]
	)
```

Method usage:
```javascript
React.render(<YourRootComponent />, document.getElementById('id1');
```

It's possible to have multiple root nodes.
---

# Small component

React component API is the most complicated part of React.js.

This is smallest React component:

- using JSX
```javascript
var YourRootComponent = React.createClass(
    render: function() {
        return <div>Hello world {date={new Date()}}</div>
    })
```


- without JSX
```javascript
var YourRootComponent = React.createClass(
    render: function() {
        return React.createElement('li', null, "Hello world" + new Date())
    })
```

Render method's return value is transformed into virtual and real DOM
---


# Component api

```javascript
var YourRootComponent = React.createClass(
    // Component-specific state
    getInitialState // initial components state
    getDefaultProps // default props values
    propTypes // Strict typed components!

    mixins // Add mixins, which are smart about Lifecycle methods

    // Lifecycle methods
    componentWillMount
    componentDidMount // Opportunity for component's DOM manipulation
    componentWillReceiveProps  // Opportunity to set component's state
    shouldComponentUpdate  // Opportunity to prevent rendering
    componentWillUpdate
    componentDidUpdate
    componentWillUnmount // Opportunity to unregister event listeners

    render: function() {
        return <div>Hello world {date={new Date()}</div>
    }
})
```
---

# React.js data flow
In React.js data is passed from parent components to children using props.

Child components call parents, using passed callbacks.
```javascript
var ItemsList = React.createClass(
    getInitialState: function() {
        return {items: ["item1", "item2", "item3"]
    },
    _handleItemRemove: function(clickedItem) {
        var filteredItems = this.state.items.filter(
             function(item) {return item !== clickedItem}
        )
        this.setState({items: filteredItems});
    }
    render: function() {
        return <Item onRemove={this._handleItemRemove} items={this.state.items} />
    })
}
```
---
# Debugging tools
<img width='800px' src='assets/img/react_debug.png' />

<a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en">Chrome addon</a>
---

# How virtual DOM works


Every setState triggers newVirtualDOM - existingVirtualDOM comparison and re-renders the whole sub-tree, applying minimal updates to DOM.

<img width='320px' style='float: right' src='assets/img/virtual-dom.png' />

Ways to improve performance:
-  call setState as low as possible
-  use shouldComponentUpdate to prevent re-rendering of large sub-tree
-  compare only State component receives with immutable values and PureRenderMixin.

Preventing re-rendering:

<img width='320px' style='float: right'  src='assets/img/virtual-dom-optimisation.png' />

---

# Nice features. #1 - Ease of composability


```javascript
...
    render: function() {
        return (
            <BaseModal
                closeBtn={true}
                onClose={this.props.onClose}
                isOpen={this.props.isOpen}
            >
                <form>
                    <div className='input-pair'>
                        <div className='input-pair__title-box'>
                            NAME
                        </div>
                        <div className='input-pair__input-box'>
                            <MacSelect
                                name='country'
                                options={[{value: 'Ukraine', label: 'Ukraine'}, ...]}
                                value={this.state.storedParams.country}
                                onChange={this._onInputChange}
                            />
                        </div>
                    </div>
...
```


---
# Nice features. #2 - No templating language

React Component instances are manipulated using plain old JavaScript

```javascript
...
render: function() {
    return (
        <div className='assets-grid'>
            <div className='assets-grid__items'>
               {this.state.assets.map(function(asset, index) {
                    return <AssetGridItem key={index} asset={asset} />
               })}
            </div>
        </div>
    );
}
...

var obj = {
    a: <div>hello</div>,
    b: <ListItem />
};

var listItem = predicate ? <ListItemA /> : <ListItemB />

```

---
# Nice features. #3 - PropTypes
PropTypes provide strict typing for component's parameters

```javascript
var YourRootComponent = React.createClass(
    ...
    propTypes: function() {
        return {
           size: React.PropTypes.number,
           position: React.PropTypes.string.isRequired,
           React.PropTypes.oneOf(['News', 'Photos']),
           React.PropTypes.instanceOf(Message)
        }
    }
    ...
)
```

---

# Roadmap to convincing boss to use React.js

- Facebook, Instagram, Khan Academy, New York Times use it
- Simpler code
- Ability to incrementally add it to existing projects
- Performance
- Stable version, compared to Angular

---

# Flux architecture
![MVC-js](assets/img/flux-drawing.jpg)
<small>https://twitter.com/abdullin/status/553292397506220034/photo/1</small>

Key features:
- Unidirectional data flow
- Flux stores are domain models, not ORM models
- Flux is more similar to CQRS than MVC

---

# Components
<img width='600px'  src='assets/img/flux_component.png' />

Components can only call Action Creators and cannot modify Stores directly.

Example:

```javascript
actions.addProductToCart(this.props.product);
```
---

# Action creators
<img width='600px'  src='assets/img/flux_action_creator.png' />

Example:
```javascript
loadMoreSearchResults: function(parameters) {
    this.dispatch(constants.LOAD_MORE_SEARCH_RESULTS_PROGRESS);
    searchDao.advancedSearch({parameters: parameters}).then(function(results) {
        dispatcher.dispatch(constants.LOAD_MORE_SEARCH_RESULTS_SUCCESS, results);
    }));
},
```
---

# Stores
<img width='600px'  src='assets/img/flux_store.png' />

Store is a wrapper for Model with separate write and read interfaces.
- write interface methods are invoked after matching Dispatcher Actions are triggered;
- read interface corresponds to UI needs.
- Stores don't mutate each other
---

# Buzzwords
CQRS!

Low Coupling!

No Black-box framework magic!

Unidirectional dataflow easy to reason about!

Performance optimization!

// TODO: add some links to buzzwords
    </textarea>
<!-- ================== End of Slides ================== -->

    <script src="./assets/js/remark-latest.min.js" type="text/javascript"></script>
    <script type="text/javascript">remark.create({highlightStyle: 'github'});</script>
</body>
</html>
